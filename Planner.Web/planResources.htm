<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

	<!-- Basic Page Needs
  ================================================== -->
	<meta charset="utf-8">
	<title>Plan Resources</title>
	<meta name="description" content="">
	<meta name="author" content="">
	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
  ================================================== -->
	<link rel="stylesheet" href="stylesheets/base.css">
	<link rel="stylesheet" href="stylesheets/skeleton.css">
	<link rel="stylesheet" href="stylesheets/layout.css">
    <link rel="stylesheet" href="stylesheets/tables.css">

	<!-- Favicons
	================================================== -->
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

    <script type="text/javascript" src="Scripts/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="Scripts/jquery.dateFormat-1.0.js"></script>
    <script type="text/javascript" src="Scripts/knockout-2.0.0.js"></script>
    <script type="text/javascript" src="Scripts/knockout-array-filter.js"></script>
    <script type="text/javascript" src="Scripts/jquery.editinplace.js"></script>
    <script type="text/javascript" src="javascripts/ko.bindingHandlers.editable.js"></script>
    <script type="text/javascript" src="javascripts/ko.bindingHandlers.fadeVisible.js"></script>
    <script type="text/javascript" src="Scripts/koExternalTemplateEngine_all.min.js"></script>
        
    <script type="text/javascript" src="javascripts/Mixin.js"></script>
    <script type="text/javascript" src="javascripts/release.js"></script>
    <script type="text/javascript" src="javascripts/planResourcesViewmodel.js"></script>
    <script type="text/javascript" src="javascripts/ajax.js"></script>
    <script type="text/javascript" src="javascripts/Roles.js"></script>
    <script type="text/javascript" src="javascripts/UseCases.js"></script>
</head>
<body>
<!-- Primary Page Layout
	================================================== -->

	<!--Process: for this page the projects that are included in a release are given. This happens through importing TFS workload and mapping the IterationPaths to Projects
    Consequence is that all pulldowns need to be prefilled with phases and projects being related through -->
    <div class="container">
        <div class="band navigation">
	
		    <nav class="primary container">
			    <ul>
				    <li><a href="Release.htm">Release Status</a></li>
				    <li><a href="Phases.htm">Phases Overview</a></li>
				    <li><a href="#">Administration</a>
						    <ul>
							    <li><a href="addRelease.htm"><span>- </span>Admin Release</a></li>
							    <li><a href="adminProject.htm"><span>- </span>Admin Project</a></li>
						    </ul>
				    </li>
				    <li><a href="planResources.htm"><span>- </span>Plan Resources</a></li>
			    </ul>
		    </nav>
	    </div><!--end band-->

        <section id="criteria" class="sixteen columns">
            <div id="releases" class="five columns alpha">
                Release: <select data-bind="options: allReleases, optionsText: 'title', value: selectedRelease, optionsCaption: 'Choose...'"></select>
            </div>

            <div id="Div1" class="five columns alpha">
                Phase: <select data-bind="options: selectedRelease().phases, optionsText: 'title', value: selectedPhase, optionsCaption: 'Choose...'"></select>
            </div>
            
            <div id="projects" class="five columns alpha">
                Project: <select data-bind="options: selectedRelease().projects, optionsText: 'title', value: selectedProject, optionsCaption: 'Choose...', event: { change: $root.loadAssignments }"></select>
            </div>
        </section>

        <!-- ko if: $root.selectedProject() -->
        <div id="assignedResources" class="sixteen columns">
            <ul data-bind="foreach: assignments">
                <li>
                    <span data-bind="text: resource.fullName()"></span>
                    <span class="selectable" contenteditable="true" data-bind="text: focusFactor, editable: focusFactor"></span>
                </li>
            </ul>
            <button data-bind="click: $root.addResource.bind($data)">+ Resource</button>
        </div>
        <!--/ko-->

        <!-- ko if: $root.selectedProject() -->
        <section id="addAssignmentForm" class="sixteen columns" data-bind="fadeVisible: $root.canShowForm(), fadeDuration: 500">
                <!-- ko template: {name: 'addAssignment', data: $root.newAssignment} -->
                <!-- /ko -->
        </section>
        <!--/ko-->

        <button data-bind="click: $root.saveAssignments.bind($data)">Save</button>
    </div>

<script type="text/javascript">
    function loadReleases(resources) {
        var uc = new ULoadPlanResources();
        var ajx = new Ajax();
        // use closure around execute method to pass 'projects' argument as well as 'data' from getReleaseSummaries callback
        ajx.getReleaseSummaries(function (data) { uc.execute(data, resources) });
    }

    $(document).ready(function () {
        infuser.defaults.templateSuffix = ".tmpl.html";
        infuser.defaults.templateUrl = "/planner/templates";

        var ajax = new Ajax();
        ajax.getResources(loadReleases);
        //var uc = new ULoadPlanResources();
        //ajax.getReleaseSummaries(uc.execute);
    });
</script>    
</body>
</html>

